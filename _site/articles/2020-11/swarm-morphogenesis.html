<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="A partner and I created a simulation of decentralized swarm of 2D robots that exhibited self-assembling properties. Agents had no knowledge of desired end-st...">
  <meta name="keywords" content="portfolio, projects, and engineering">
  <meta name="author" content="Decentralized Swarm Morphogenesis | Jonathan Zerez">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#f5f5f5">

  <!-- Twitter Tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Decentralized Swarm Morphogenesis | Jonathan Zerez">
  <meta name="twitter:description" content="A partner and I created a simulation of decentralized swarm of 2D robots that exhibited self-assembling properties. Agents had no knowledge of desired end-st...">
  
    <meta property="twitter:image" content="http://localhost:4000/img/leonids-logo.png">
  

  <!-- Open Graph Tags -->
  <meta property="og:type" content="blog">
  <meta property="og:url" content="http://localhost:4000/articles/2020-11/swarm-morphogenesis">
  <meta property="og:title" content="Decentralized Swarm Morphogenesis | Jonathan Zerez">
  <meta property="og:description" content="A partner and I created a simulation of decentralized swarm of 2D robots that exhibited self-assembling properties. Agents had no knowledge of desired end-st...">
  
    <meta property="og:image" content="http://localhost:4000/img/leonids-logo.png">
  
  <title>Decentralized Swarm Morphogenesis | Jonathan Zerez</title>

  <!-- CSS files -->
  <link rel="stylesheet" href="http://localhost:4000/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://localhost:4000/css/main.css">

  <link rel="canonical" href="http://localhost:4000/articles/2020-11/swarm-morphogenesis">
  <link rel="alternate" type="application/rss+xml" title="Jonathan Zerez" href="http://localhost:4000/feed.xml" />

  <!-- Icons -->
  <!-- 16x16 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
  <!-- 32x32 -->
  <link rel="shortcut icon" href="http://localhost:4000/favicon.png">
</head>


<body>
  <div class="row">
    <div class="col s12 m3" id="static-mobile">
      <div class="table cover mobile-hide">
        

<div class="cover-card table-cell table-middle">
  
  <a href="http://localhost:4000/">
    <img src="http://localhost:4000/img/profile_new.jpg" alt="" class="avatar mobile-hide">
  </a>
  
  <a href="http://localhost:4000/" class="author_name">Jonathan Zerez</a>
  <span class="author_job">Mechanical Design Engineer @ Amazon Robotics</span>
  <span class="author_bio mbm mobile-hide">I'm a mechanical engineer interested in computational simulation, optimization, and design automation. This website is a brief showcasing of some of the various projects I've worked on</span>
  <nav class="nav">
    <ul class="nav-list">
      <li class="nav-item">
        <a href="http://localhost:4000/">featured</a>
      </li>
       
      <li class="nav-item">
        <a href="http://localhost:4000/archive/">all projects</a>
      </li>
            
      <li class="nav-item">
        <a href="http://localhost:4000/categories/">Project Categories</a>
      </li>
          
      <li class="nav-item">
        <a href="http://localhost:4000/about/">About Me</a>
      </li>
         
    </ul>
  </nav>
  <script type="text/javascript">
  // based on http://stackoverflow.com/a/10300743/280842
  function gen_mail_to_link(hs, subject) {
    var lhs,rhs;
    var p = hs.split('@');
    lhs = p[0];
    rhs = p[1];
    document.write("<a class=\"social-link-item\" target=\"_blank\" href=\"mailto");
    document.write(":" + lhs + "@");
    document.write(rhs + "?subject=" + subject + "\"><i class=\"fa fa-fw fa-envelope\"></i><\/a>");
  }
</script>
<div class="social-links">
  <ul>
    
      <li>
      <script>gen_mail_to_link('jzerez@olin.edu', 'Hello from website');</script>
      </li>
    
    
    
    
    <li><a href="http://linkedin.com/in/jonathan-zerez" class="social-link-item" target="_blank"><i class="fa fa-fw fa-linkedin"></i></a></li>
    
    
    
    
    <li><a href="http://github.com/jzerez" class="social-link-item" target="_blank"><i class="fa fa-fw fa-github"></i></a></li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </ul>
</div>

  <br />
</div>

      </div>
    </div>
    <div class="col s12 m9">
      <div class="post-listing mobile">
        <a class="btn" href= "http://localhost:4000/" >
  Home
</a>



<div id="post">
  <hr style="border-top: 3px solid rgba(0,0,0,0.1)"/>
  <header class="post-header">
    <h1 title="Decentralized Swarm Morphogenesis">Decentralized Swarm Morphogenesis</h1>
    <p>A partner and I created a simulation of decentralized swarm of 2D robots that exhibited self-assembling properties. Agents had no knowledge of desired end-state and self-assembled into complex shapes based only on local interactions modeled after a reaction-diffusion system.</p>
    
    <a href="https://github.com/jzerez/swarms/" class="btn" title="View on Github"><i class="fa fa-github"></i><span style="padding: 10px">View on Github</span></a>
    
    

    

    
    <br />
    <span class="post-meta">
      <span class="post-date">
        1 NOV 2020
      </span>

      
      •
      
        <a class="post-cat" href="http://localhost:4000/categories/#Software">Software</a>
        
        <span>/</span>
        
      
        <a class="post-cat" href="http://localhost:4000/categories/#Simulation">Simulation</a>
        
      
      
    </span>

    <hr style="border-top: 3px solid rgba(0,0,0,0.1)"/>
  </header>

  <article class="post-content">
    <h1 id="swarms">Swarms</h1>
<p><strong>ENGR3590: A Computational Introduction to Robotics, Olin College of Engineering, FA2020</strong></p>

<p><em>Nathan Estill, Jonathan Zerez</em></p>

<table>
  <tbody>
    <tr>
      <td><img src="../../img/swarm-morphogenesis/animations/0.43_0.19_0.035_-0.1_10100frames.gif" alt="png" /></td>
      <td><img src="../../img/swarm-morphogenesis/animations/0.5_0.25_0.06_-0.124_80000frames.gif" alt="png" /></td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<p>In this project, we set out to create a simulated decentralized robot swarm that would exhibit self-assembling properties. Specifically, we wanted to replicate morphogenesis, the process by which cells are able to self-organize themselves in order to form complex tissues and organs through local interactions alone. This is of great interest to us, as decentralized systems are full of complexity, and are quite different from centralized robotic systems. Decentralized swarms offer a number of really cool advantages in that they are very robust to external noise, damage to a number of individual agents within the swarm, and unpredictable variations in the environment.</p>

<h2 id="introduction">Introduction</h2>
<p>For this project, we created a 2D simulation of simple robotic agents on a grid world. These agents are allowed to communicate and sense their nearest neighbors, and are allowed to move with discrete steps around the grid. By implementing that dictate how the robots interact with each other and how they move, we are able to get the swarm to self assemble into complex shapes.</p>

<p>We accomplished this by first implementing a simulated reaction-diffusion system among the robotic agents. This would create virtual reaction-diffusion patterns in the swarm of areas with high and low chemical concentrations. From here, we instructed robots on the edge of the swarm to move until they were able to find locations of sufficiently high chemical concentrations. The movement of the agents in some cases, helped the reaction-diffusion patterns to further evolve, driving the entire structure of the swarm to change over time.</p>

<p>This project was inspired by <a href="https://robotics.sciencemag.org/content/3/25/eaau9178"><em>Morphogenesis in Robot Swarms</em></a> by I. Slavkov et. al. They successfully modeled and physically implemented a <a href="https://www.k-team.com/mobile-robotics-products/kilobot">Kilobot</a> swarm that underwent simulated reaction-diffusion using virtual chemicals, and exhibited complex emergent behavior of self assembly. We set out to replicate this work and to see if we could produce any patterns that were more interesting.</p>

<h2 id="theory-reaction-diffusion">Theory: Reaction-Diffusion</h2>
<p>Reaction-Diffusion was used to create the patterns that drove the movement patterns of the robot. As it is an important part of the project, we will briefly describe what a Reaction-Diffusion system is and how it works in this section below.</p>

<p>Reaction diffusion patterns arise through a number of different phenomena: diffusion, chemical reaction, and artificial chemical limiting. In our implementation, there are two chemical concentrations that are associated with each robot in the grid. We call them chemical <code class="language-plaintext highlighter-rouge">A</code> and chemical <code class="language-plaintext highlighter-rouge">B</code>.</p>

<p>Over time, the chemicals are allowed to diffuse, meaning that areas of high concentrations will tend to flatten out over time. Diffusion at a location is proportional to the divergence at that location.</p>

<p><img src="https://latex.codecogs.com/gif.latex?\text{Diffusion}%20\propto%20\nabla%20\cdot%20A" alt="dis" /></p>

<p>Chemicals are also allowed to react with each other. In our case, chemical <code class="language-plaintext highlighter-rouge">A</code> forms chemical <code class="language-plaintext highlighter-rouge">B</code>, as dictated by the following equation:</p>

<p><img src="https://latex.codecogs.com/gif.latex?\text{Reaction}=AB^2" alt="tex" /></p>

<p>Finally, we artificially limit chemical concentrations by constantly adding in chemical <code class="language-plaintext highlighter-rouge">A</code> and constantly removing chemical <code class="language-plaintext highlighter-rouge">B</code> in order to ensure the reaction-diffusion system can keep going without achieving a boring equilibrium point.</p>

<p>If we add all of these terms up, we find that the rate of change for chemical <code class="language-plaintext highlighter-rouge">A</code> is:</p>

<p><img src="https://latex.codecogs.com/gif.latex?\frac{\delta%20A}{\delta%20t}=c_A\nabla\cdot%20A-AB^2+l_A(1-A)" alt="tex" />
<br />
<br />
And similarly for chemical <code class="language-plaintext highlighter-rouge">B</code>:</p>

<p><img src="https://latex.codecogs.com/gif.latex?\frac{\delta%20B}{\delta%20t}=c_B\nabla\cdot%20A-AB^2+l_B(B)" alt="tex" /></p>

<p><br />
<br />
In both equations, the first term corresponds to diffusion of the chemical and is proportional to the divergence of that chemical. The second term is the reaction, and the final term is the artificial chemical limiting. Note, we refer to <code class="language-plaintext highlighter-rouge">lA</code> and <code class="language-plaintext highlighter-rouge">lB</code> as <code class="language-plaintext highlighter-rouge">a_add_rate</code> and <code class="language-plaintext highlighter-rouge">b_add_rate</code> in this project.</p>

<p>Below are some examples of reaction-diffusion patterns:</p>

<table>
  <thead>
    <tr>
      <th><img src="../../img/swarm-morphogenesis/images/4500_0.039_0.104.png" alt="png" /></th>
      <th><img src="../../img/swarm-morphogenesis/images/4500_0.055_0.117.png" alt="png" /></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ca=0.5, cb=0.25, a_add_rate=0.039, b_add_rate=-0.104</code></td>
      <td><code class="language-plaintext highlighter-rouge">ca=0.5, cb=0.25, a_add_rate=0.055, b_add_rate=-0.117</code></td>
    </tr>
  </tbody>
</table>

<p>For more information about Reaction-Diffusion, see our <a href="https://github.com/jzerez/swarms/blob/main/writeups/blogpost1/blogpost1.md">first blogpost</a> on the subject.</p>

<h2 id="implementation-details">Implementation Details</h2>
<h3 id="overview">Overview</h3>
<p>The project contains two main objects, a <code class="language-plaintext highlighter-rouge">Simulator</code> object and a <code class="language-plaintext highlighter-rouge">Robot</code> object. The <code class="language-plaintext highlighter-rouge">Simulator</code> object contains all of the <code class="language-plaintext highlighter-rouge">Robot</code> objects and is responsible for managing their mutual localized sensing. Each <code class="language-plaintext highlighter-rouge">Robot</code> is responsible for updating itself based on the neighbors provided to it by the <code class="language-plaintext highlighter-rouge">Simulator</code> object.</p>

<p><img src="../../img/swarm-morphogenesis/images/BlockDiagram.png" alt="png" /></p>

<p>The <code class="language-plaintext highlighter-rouge">Simulator</code> contains a 2D <code class="language-plaintext highlighter-rouge">numpy</code> array that contains all of the robots, as well as any empty spaces. The position of each robot is equivalent to its x and y indices in the 2d grid array. Each robot’s position is discrete and corresponds to a grid location: there is no continuous motion in the simulation.</p>

<p>The robotic agents were modeled after Kilobots. The Robot class contains its chemical concentrations of <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code>, its position, reaction diffusion parameters, and notable kernels. Each robot is able to communicate with other nearby robots. If a robot is broadcasting a message, only robots in the eight gridspaces directly adjacent to its current position will be able to receive the message. Like Kilobots, our implemented robots are able to determine how far away the origin of a signal is, but are unable to determine what direction the signal is coming from.</p>

<h3 id="simulation">Simulation</h3>

<p>We start with a simulation of many small robots in a space. Initially, they are arranged in a circle in the center of the grid. All robots have an initial chemical concentration of <code class="language-plaintext highlighter-rouge">A=1</code>. The chemical concentration of <code class="language-plaintext highlighter-rouge">B</code> for each robot varies randomly from 0 to 0.1. Additionally, robots in the center of the circle are given an additional 0.1 of <code class="language-plaintext highlighter-rouge">B</code> in order to get the reaction started. The initialized grid is shown below.</p>

<p><img src="../../img/swarm-morphogenesis/images/initialized_grid.png" alt="Grid" /></p>

<p>After initializing the grid and the robots within it, we calculate and store the set of robots that are on the edge of the grid, as shown below. This is important as robots on the edge require extra updates for each timestep. Keeping track of which robots are on the edge of the shape ensures that we can minimize the runtime by avoiding running costly update functions on robots that don’t need it. The figure below shows in red which robots are considered to be at the edge of the swarm for the initial starting grid.</p>

<p><img src="../../img/swarm-morphogenesis/images/calc_edge_robots.png" alt="Edge Robots" /></p>

<p>The simulation is tasked with updating the neighbors to each robot. Because we store the robots in a 2D array, this task is relatively simple. Getting the neighbors of a robot is an example of a task that only needs to be performed on edge robots. Robots in the center of the swarm are stationary and their neighbors do not change over time.</p>

<p><img src="../../img/swarm-morphogenesis/images/get_neighbors.png" alt="Neighbors" /></p>

<h3 id="reaction-diffusion-update">Reaction Diffusion Update</h3>
<p>At each time step, all of the robots update their chemical concentrations. To do this, we start by having each robot calculate its chemical divergence from its neighbors. This means essentially taking the difference between its own chemical concentrations and the chemical concentrations of its neighbors. This can be seen more in the figure below.</p>

<p><img src="../../img/swarm-morphogenesis/images/calc_div.png" alt="div" /></p>

<p>Then we calculate the reaction, which reduces the concentration of <code class="language-plaintext highlighter-rouge">A</code> and increases the concentration of <code class="language-plaintext highlighter-rouge">B</code> as the chemical <code class="language-plaintext highlighter-rouge">A</code> reacts to form chemical <code class="language-plaintext highlighter-rouge">B</code>.</p>

<p>Then we modify the robot’s concentrations of <code class="language-plaintext highlighter-rouge">A</code> and <code class="language-plaintext highlighter-rouge">B</code> based on the divergence and reaction we calculated earlier, as well as a static amount of <code class="language-plaintext highlighter-rouge">A</code> that we add and <code class="language-plaintext highlighter-rouge">B</code> that we remove to offset the overall reaction of <code class="language-plaintext highlighter-rouge">A</code> that turns into <code class="language-plaintext highlighter-rouge">B</code>.</p>

<h3 id="robot-movement">Robot Movement</h3>
<p>Because we want the robots to spatially form interesting shapes, they have to move in a specific way. To start, we must pick a robot that is supposed to move. We first randomly select a robot from the list of edge robots that is also not near a high concentration of chemical <code class="language-plaintext highlighter-rouge">B</code> (typical threshold value of <code class="language-plaintext highlighter-rouge">B</code> is 0.06)</p>

<p>To move the robot, we randomly select a adjacent empty grid space that is also adjacent to another robot in the 3x3 grid. This space also cannot be the space the robot just came from. We calculate this using the following kernel and convolving it against the neighbors of the current robot, where we use 1’s to represent neighboring robots, and 0’s to represent empty grid spaces.</p>

<p><img src="../../img/swarm-morphogenesis/images/valid_move.png" alt="Valid Move" /></p>

<p>The robot moves to this space and makes a note of all of its previous and new neighbors. Each of these neighbors recalculates whether it is on the edge or not, and we modify the edge robots set to contain any robots that are now on the edge or remove any robots that are no longer on the edge.</p>

<p>If the moving robot is now near a high concentration of <code class="language-plaintext highlighter-rouge">B</code>, we signal to look for a new robot in the next time step. If not, we continue to move that same robot. This results in robots clustering around high concentrations of <code class="language-plaintext highlighter-rouge">B</code>.</p>

<p>Technically, because the <code class="language-plaintext highlighter-rouge">Simulator</code> class chooses one and only one random robot to be moving at a time, the program is technically not truly decentralized. If we had more time, we could create a method for robots to communicate their movement intentions with their neighbors in order to give rise to spontaneous and truly decentralized movement while avoiding traffic jams.</p>

<h3 id="results">Results</h3>
<p>Once these code aspects were working, we changed the reaction diffusion parameters to get interesting patterns to form. We got the following patterns after a lot of fiddling with the parameters.</p>

<p><img src="../../img/swarm-morphogenesis/animations/0.5_0.25_0.06_-0.124_80000frames.gif" alt="Worm" /></p>

<p>The parameters for this animation are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">cA</code>: 0.5</li>
  <li><code class="language-plaintext highlighter-rouge">cB</code>: 0.25</li>
  <li><code class="language-plaintext highlighter-rouge">a_add_rate</code>: 0.06</li>
  <li><code class="language-plaintext highlighter-rouge">b_add_rate</code>: -0.124</li>
</ul>

<p>In this simulation, we tuned the reaction diffusion patterns to give rise to a single line of high concentration that tends to grow over time. Our hope was that as the line of high concentration moved out to the edges of the shape, agents would tend to coallese around them, allowing the line of high concentration to grow further. In practice, we found that the robots do not move fast enough, and the line tends to start to curve off to the side instead. However, we still believe that this is an interesting result because the robots are clearly following the changing chemical gradient.</p>

<p><img src="../../img/swarm-morphogenesis/animations/0.43_0.19_0.035_-0.1_10000frames.gif" alt="Polka Dots" /></p>

<p>The parameters for this animation are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">cA</code>: 0.43</li>
  <li><code class="language-plaintext highlighter-rouge">cB</code>: 0.19</li>
  <li><code class="language-plaintext highlighter-rouge">a_add_rate</code>: 0.035</li>
  <li><code class="language-plaintext highlighter-rouge">b_add_rate</code>: -0.1</li>
</ul>

<p>In this simulation, we tuned the reaction diffusion patterns to give rise to a series of polka dots or islands of high concentration. This is similar to the pattern used by Slavkov et. al. As the islands of high concentration move towards the edge of the shape, agents tend to from lobes centered around those islands. We believe that if we were able to tune the parameters, we accentuate how much each “lobe” sticks out, creating a more interesting shape.</p>

<p><img src="../../img/swarm-morphogenesis/animations/0.5_0.25_0.06_-0.124_80000frames_1.gif" alt="Worm2" /></p>

<p>The parameters for this animation are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">cA</code>: 0.5</li>
  <li><code class="language-plaintext highlighter-rouge">cB</code>: 0.25</li>
  <li><code class="language-plaintext highlighter-rouge">a_add_rate</code>: 0.06</li>
  <li><code class="language-plaintext highlighter-rouge">b_add_rate</code>: -0.124</li>
</ul>

<p>This simulation is similar to the first, but exhibits some interesting branching of the line of high concentration.</p>

<p>In this project, we generated a TON of different graphics and visualizations of the simulation. We created a separate gallery page where you can see the interesting visuals we’ve produced along the way. That gallery can be found <a href="https://github.com/jzerez/swarms/blob/main/writeups/mainpage/gallery.md">here</a>.</p>

<h2 id="resources">Resources</h2>
<ol>
  <li><a href="https://science.sciencemag.org/content/sci/343/6172/754.full.pdf?ijkey=wcGE/tKMM5iGM&amp;keytype=ref&amp;siteid=sci">TERMES</a></li>
  <li><a href="https://dash.harvard.edu/bitstream/handle/1/11213398/iros11wksp-werfel.pdf?sequence=1&amp;isAllowed=y">TERMES Algorithm Paper</a></li>
  <li><a href="https://link.springer.com/article/10.1007/s42001-019-00037-9">Dynamic Organization of flocking behaviors in a large-scale boids model</a></li>
  <li><a href="https://arxiv.org/pdf/2009.14279.pdf">An overview on optimal flocking</a></li>
  <li><a href="https://robotics.sciencemag.org/content/3/25/eaau9178">Morphogenesis in robot swarms</a></li>
  <li><a href="https://science.sciencemag.org/content/345/6198/795.full">Programmable self-assembly in a thousand-robot swarm</a></li>
</ol>

  </article>
</div>




        <footer>
  Powered by <a href="http://jekyllrb.com/">Jekyll</a>, <a href="http://github.com/renyuanz/leonids/">leonids theme</a>
</footer>

      </div>
    </div>
  </div>
  <script type="text/javascript" src="http://localhost:4000/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="http://localhost:4000/js/main.js"></script>


</body>
</html>
